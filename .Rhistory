ciuo08_clio == "5522" & id == "var_223" ~ "3343",
ciuo08_clio == "5521" & id == "var_2536" ~ "7322",
TRUE ~ ciuo08_clio
)
)
## Volver a crear ciuo08 con 2 dígitos
data <- data %>%
mutate(
ciuo08_clio_2d = as.numeric(substr(ciuo08_clio, 1, 2)),
ciuo08_clio_2d = ifelse(ciuo08_clio_2d==-9, NA,ciuo08_clio_2d)
) %>%
set_variable_labels(ciuo08_clio_2d = "ISCO-08: 2 digits")
frq(data$ciuo08_clio_2d)
# Chequeo COMPLETO de códigos ciuo08 con api INE
## Enviar la consulta al servidor
request <-  httr::POST("https://rapps.ine.cl:9292/predict",
encode = "json",
body =  list(text = data$glosa_ciuo08,
classification = "ciuo",
digits = 2))
## Extraer el contenido
ciuo08_ine <- httr::content(request)
## Agregar como nueva columna a la base original
data$ciuo08_ine <- unlist(ciuo08_ine$cod_final)
## Volver NA en ciuo08_ine los NA de ciuo08_clio_2d
data <- data %>%
mutate(
ciuo08_ine = ifelse(is.na(ciuo08_clio_2d), NA, ciuo08_ine)
)
## Buscar los códigos diferentes
diferente_ciuo <- data %>%
filter(ciuo08_ine != ciuo08_clio_2d | (is.na(ciuo08_ine) != is.na(ciuo08_clio_2d))) %>%
select(glosa_ciuo08, ciuo08_clio_2d, ciuo08_ine)
diferente_ciuo
data <- data %>%
mutate(
skills = case_when(
ciuo08_ine <= 34 & educ >= 9 ~ 1,
ciuo08_ine <= 34 & is.na(educ)~ 1,
ciuo08_ine <= 34 & educ < 9 ~ 2,
ciuo08_ine %in% c(35, 36, 41:44, 53) ~ 2,
ciuo08_ine %in% c(51, 54, 61, 62, 71:75, 81) & educ >= 5 ~ 2,
ciuo08_ine %in% c(61, 62, 71:75) & is.na(educ) ~ 2,
ciuo08_ine %in% c(51, 54, 61, 62, 71:75, 81) & educ <= 4 ~ 3,
ciuo08_ine %in% c(52, 63, 82, 83, 91:99) ~ 3,
ciuo08_ine %in% c(51, 54, 81) & is.na(educ) ~ 3
),
skills = factor(
skills,
levels = 1:3,
labels = c(
"1. Experts",
"2. Skilled",
"3. Unskilled"
)
)
) %>%
set_variable_labels(skills = "Skills")
frq(data$skills)
frq(data$a15)
data <- data %>%
mutate(
formal_position_auth = case_when(
as.numeric(relation_mop) %in% c(1, 2) ~ NA_real_,
TRUE ~ as.numeric(a15)
),
formal_position_auth = factor(
formal_position_auth,
levels = 1:4,
labels = c(
"1. Senior manager or executive",
"2. Middle manager (e.g., sector, office or branch head)",
"3. Supervisor or foreperson",
"4. Regular employee or worker (no supervisory role)"
)
)
) %>%
set_variable_labels(formal_position_auth = "Formal position of authority (a15)")
frq(data$formal_position_auth)
frq(data$a16)
data <- data %>%
mutate(
supervision = case_when(
a16 == 1 ~ 1,
a16 %in% c(2, -888, -999) ~ 0,
TRUE ~ NA_real_
)
) %>%
set_variable_labels(supervision = "Supervises other workers (a16)")
frq(data$supervision)
frq(data$a17_01)
frq(data$a17_02)
frq(data$a17_03)
frq(data$a17_04)
frq(data$a17_05)
frq(data$a17_06)
data <- data %>%
mutate(
decisionmaking_typology = if_else(
is.na(a17_01),
NA_real_,
rowSums(across(a17_01:a17_06, ~ case_when(
.x == 1 ~ 3,
.x == 2 ~ 2,
.x == 3 ~ 1,
.x %in% c(-888, -999) ~ 1,
TRUE ~ NA_real_
)), na.rm = TRUE)
),
decisionmaking_typology_mean = if_else(
is.na(a17_01),
NA_real_,
rowMeans(across(a17_01:a17_06, ~ case_when(
.x == 1 ~ 3,
.x == 2 ~ 2,
.x == 3 ~ 1,
.x %in% c(-888, -999) ~ 1,
TRUE ~ NA_real_
)), na.rm = TRUE)
)
) %>%
set_variable_labels(
decisionmaking_typology = "Decision-making typology (sum, inverted)",
decisionmaking_typology_mean = "Decision-making typology (mean, inverted)"
)
frq(data$decisionmaking_typology)
frq(data$decisionmaking_typology_mean)
# Crear variable con 3 categorías
data <- data %>%
mutate(
decisionmaking_typology_cat = case_when(
decisionmaking_typology_mean == 1 ~ 1,
decisionmaking_typology_mean > 1 & decisionmaking_typology_mean < 3 ~ 2,
decisionmaking_typology_mean == 3 ~ 3
),
decisionmaking_typology_cat = factor(
decisionmaking_typology_cat,
levels = 1:3
)
) %>%
set_variable_labels(
decisionmaking_typology_cat = "Decision-making typology (recoded 3 categories)"
)
frq(data$decisionmaking_typology_cat)
data <- data %>%
mutate(
managerial_location_typology = case_when(
as.integer(decisionmaking_typology_cat) == 3 & supervision == 1 & as.integer(formal_position_auth) %in% 1:3 ~ 1,
as.integer(decisionmaking_typology_cat) == 3 & supervision == 1 & as.integer(formal_position_auth) == 4 ~ 2,
as.integer(decisionmaking_typology_cat) == 3 & supervision == 0 & as.integer(formal_position_auth) %in% 1:3 ~ 3,
as.integer(decisionmaking_typology_cat) == 3 & supervision == 0 & as.integer(formal_position_auth) == 4 ~ 4,
as.integer(decisionmaking_typology_cat) == 2 & supervision == 1 & as.integer(formal_position_auth) %in% 1:3 ~ 5,
as.integer(decisionmaking_typology_cat) == 2 & supervision == 1 & as.integer(formal_position_auth) == 4 ~ 6,
as.integer(decisionmaking_typology_cat) == 2 & supervision == 0 & as.integer(formal_position_auth) %in% 1:3 ~ 7,
as.integer(decisionmaking_typology_cat) == 2 & supervision == 0 & as.integer(formal_position_auth) == 4 ~ 8,
as.integer(decisionmaking_typology_cat) == 1 & supervision == 1 & as.integer(formal_position_auth) %in% 1:3 ~ 9,
as.integer(decisionmaking_typology_cat) == 1 & supervision == 1 & as.integer(formal_position_auth) == 4 ~ 10,
as.integer(decisionmaking_typology_cat) == 1 & supervision == 0 & as.integer(formal_position_auth) %in% 1:3 ~ 11,
as.integer(decisionmaking_typology_cat) == 1 & supervision == 0 & as.integer(formal_position_auth) == 4 ~ 12
),
managerial_location_typology = factor(
managerial_location_typology,
levels = 1:12,
labels = c(
"1. Manager on all criteria",
"2. Manager not in formal hierarchy",
"3. Non-supervisory manager",
"4. Non-supervisory decision-maker not in formal hierarchy",
"5. Advisor-manager on all criteria",
"6. Advisor not in hierarchy",
"7. Non-supervisory advisor",
"8. Non-supervisory advisor not in formal hierarchy",
"9. Sanctioning / task supervisor in hierarchy",
"10. Sanctioning / task supervisor not in hierarchy",
"11. Not subordinates but in hierarchy",
"12. Non-supervisor / non manager on all criteria"
)
),
organization_assets = case_when(
as.integer(managerial_location_typology) %in% c(1, 2, 3, 5) ~ 1,
as.integer(managerial_location_typology) %in% c(6, 7, 9, 10) ~ 2,
as.integer(managerial_location_typology) %in% c(4, 8, 11, 12) ~ 3
),
organization_assets = factor(
organization_assets,
levels = 1:3,
labels = c(
"1. Manager",
"2. Supervisor",
"3. Non-managerial worker"
)
)
) %>%
set_variable_labels(
managerial_location_typology = "Managerial Location Typology",
organization_assets = "Organizational Assets"
)
frq(data$managerial_location_typology)
frq(data$organization_assets)
frq(data$a06)
table(data$a06, data$relation_mop)
table(data$a06, data$owners)
table(data$a06, data$owners2)
frq(data$a10)
table(data$a10, data$relation_mop)
table(data$a10, data$owners)
table(data$a10, data$owners2)
frq(data$a18)
table(data$a18, data$relation_mop)
tabla <- data %>%
filter(as.numeric(owners)==1)
table(tabla$a18, tabla$a06)
table(data$a18, data$a06)
table(data$owners, data$educ)
data <- data %>%
mutate(
wrightclass1_original = case_when(
as.integer(owners) == 3 ~ 1,  # Employers
as.integer(owners) == 2 ~ 2,  # Small employers
as.integer(owners) == 1 ~ 3,  # Petty bourgeoisie
as.integer(organization_assets) == 1 & as.integer(skills) == 1 ~ 4,  # Expert managers
as.integer(organization_assets) == 2 & as.integer(skills) == 1 ~ 5,  # Expert supervisors
as.integer(organization_assets) == 3 & as.integer(skills) == 1 ~ 6,  # Experts
as.integer(organization_assets) == 1 & as.integer(skills) == 2 ~ 7,  # Skilled managers
as.integer(organization_assets) == 2 & as.integer(skills) == 2 ~ 8,  # Skilled supervisors
as.integer(organization_assets) == 3 & as.integer(skills) == 2 ~ 9,  # Skilled workers
as.integer(organization_assets) == 1 & as.integer(skills) == 3 ~ 10, # Nonskilled managers
as.integer(organization_assets) == 2 & as.integer(skills) == 3 ~ 11, # Nonskilled supervisors
as.integer(organization_assets) == 3 & as.integer(skills) == 3 ~ 12  # Nonskilled workers
),
wrightclass1_original = factor(
wrightclass1_original,
levels = 1:12,
labels = c(
"1. Employers",
"2. Small employers",
"3. Petty bourgeoisie",
"4. Expert managers",
"5. Expert supervisors",
"6. Experts",
"7. Skilled managers",
"8. Skilled supervisors",
"9. Skilled workers",
"10. Nonskilled managers",
"11. Nonskilled supervisors",
"12. Nonskilled workers"
)
)
) %>%
set_variable_labels(wrightclass1_original = "Wright Class Typology")
frq(data$wrightclass1_original)
# base survey
data_svy <- as_survey_design(data, weights = rake_wb2)
# Tabla de frecuencias ponderadas
wright_freq <- data_svy %>%
group_by(wrightclass1_original) %>%
summarise(
freq = survey_mean(vartype = NULL, na.rm = TRUE),
n_unweighted = unweighted(n())
) %>%
mutate(
freq_pct = freq * 100
)
wright_freq %>%
print(n = Inf)
data <- data %>%
mutate(
wrightclass2_capitalists = case_when(
as.integer(owners2) == 3 ~ 1,  # Capitalists
as.integer(owners2) == 2 ~ 2,  # Small employers
as.integer(owners2) == 1 ~ 3,  # Petty bourgeoisie
as.integer(organization_assets) == 1 & as.integer(skills) == 1 ~ 4,  # Expert managers
as.integer(organization_assets) == 2 & as.integer(skills) == 1 ~ 5,  # Expert supervisors
as.integer(organization_assets) == 3 & as.integer(skills) == 1 ~ 6,  # Experts
as.integer(organization_assets) == 1 & as.integer(skills) == 2 ~ 7,  # Skilled managers
as.integer(organization_assets) == 2 & as.integer(skills) == 2 ~ 8,  # Skilled supervisors
as.integer(organization_assets) == 3 & as.integer(skills) == 2 ~ 9,  # Skilled workers
as.integer(organization_assets) == 1 & as.integer(skills) == 3 ~ 10, # Nonskilled managers
as.integer(organization_assets) == 2 & as.integer(skills) == 3 ~ 11, # Nonskilled supervisors
as.integer(organization_assets) == 3 & as.integer(skills) == 3 ~ 12  # Nonskilled workers
),
wrightclass2_capitalists = factor(
wrightclass2_capitalists,
levels = 1:12,
labels = c(
"1. Capitalists",
"2. Small employers",
"3. Petty bourgeoisie",
"4. Expert managers",
"5. Expert supervisors",
"6. Experts",
"7. Skilled managers",
"8. Skilled supervisors",
"9. Skilled workers",
"10. Nonskilled managers",
"11. Nonskilled supervisors",
"12. Nonskilled workers"
)
)
) %>%
set_variable_labels(wrightclass2_capitalists = "Wright Class Typology (2)")
frq(data$wrightclass2_capitalists)
# base survey
data_svy <- as_survey_design(data, weights = rake_wb2)
# Tabla de frecuencias ponderadas
wright_freq_2 <- data_svy %>%
group_by(wrightclass2_capitalists) %>%
summarise(
freq = survey_mean(vartype = NULL, na.rm = TRUE),
n_unweighted = unweighted(n())
) %>%
mutate(
freq_pct = freq * 100
)
wright_freq_2 %>%
print(n = Inf)
data <- data %>%
mutate(
wrightclass1_informal = case_when(
as.integer(owners) == 3 ~ 1,  # 1. Employers
as.integer(owners) == 2 ~ 2,  # 2. Small employers
as.integer(owners) == 1 & a06 %in% c(1, 2) ~ 3,   # 3. Petty bourgeoisie
as.integer(owners) == 1 & a06 %in% c(3, -888, -999) ~ 4,  # 4. Informal self-employed
as.integer(organization_assets) == 1 & as.integer(skills) == 1 ~ 5, # 5. Expert managers
as.integer(organization_assets) == 2 & as.integer(skills) == 1 ~ 6,  # 6. Expert supervisors
as.integer(organization_assets) == 3 & as.integer(skills) == 1 ~ 7,  # 7. Experts
as.integer(organization_assets) == 1 & as.integer(skills) == 2 ~ 8,  # 8. Skilled managers
as.integer(organization_assets) == 2 & as.integer(skills) == 2 ~ 9,  # 9. skilled supervisors
as.integer(organization_assets) == 1 & as.integer(skills) == 3 ~ 10, # 10. Nonskilled managers
as.integer(organization_assets) == 2 & as.integer(skills) == 3 ~ 11, # 11. Nonskilled supervisors
as.integer(organization_assets) == 3 & as.integer(skills) %in% c(2, 3) & a18 == 1 ~ 12,             # 12. Formal workers
as.integer(organization_assets) == 3 & as.integer(skills) %in% c(2, 3) & a18 %in% c(2, 3, 4, -999) ~ 13  # 13. Informal workers
),
wrightclass1_informal = factor(
wrightclass1_informal,
levels = 1:13,
labels = c(
"1. Employers",
"2. Small employers",
"3. Petty bourgeoisie",
"4. Informal self-employed",
"5. Expert managers",
"6. Expert supervisors",
"7. Experts",
"8. Skilled managers",
"9. Skilled supervisors",
"10. Nonskilled managers",
"11. Nonskilled supervisors",
"12. Formal workers",
"13. Informal workers"
)
)
) %>%
set_variable_labels(wrightclass1_informal = "Wright Class Typology + Informal (3)")
frq(data$wrightclass1_informal)
# base survey
data_svy <- as_survey_design(data, weights = rake_wb2)
# Tabla de frecuencias ponderadas
wright_freq_3 <- data_svy %>%
group_by(wrightclass1_informal) %>%
summarise(
freq = survey_mean(vartype = NULL, na.rm = TRUE),
n_unweighted = unweighted(n())
) %>%
mutate(
freq_pct = freq * 100
)
wright_freq_3 %>%
print(n = Inf)
data <- data %>%
mutate(
wrightclass2_informal = case_when(
as.integer(owners2) == 3 ~ 1,  # 1. Capitalists
as.integer(owners2) == 2 ~ 2,  # 2. Small employers
as.integer(owners2) == 1 & a06 %in% c(1, 2) ~ 3,   # 3. Petty bourgeoisie
as.integer(owners2) == 1 & a06 %in% c(3, -888, -999) ~ 4,  # 4. Informal self-employed
as.integer(organization_assets) == 1 & as.integer(skills) == 1 ~ 5, # 5. Expert managers
as.integer(organization_assets) == 2 & as.integer(skills) == 1 ~ 6,  # 6. Expert supervisors
as.integer(organization_assets) == 3 & as.integer(skills) == 1 ~ 7,  # 7. Experts
as.integer(organization_assets) == 1 & as.integer(skills) == 2 ~ 8,  # 8. Skilled managers
as.integer(organization_assets) == 2 & as.integer(skills) == 2 ~ 9,  # 9. skilled supervisors
as.integer(organization_assets) == 1 & as.integer(skills) == 3 ~ 10, # 10. Nonskilled managers
as.integer(organization_assets) == 2 & as.integer(skills) == 3 ~ 11, # 11. Nonskilled supervisors
as.integer(organization_assets) == 3 & as.integer(skills) %in% c(2, 3) & a18 == 1 ~ 12,             # 12. Formal workers
as.integer(organization_assets) == 3 & as.integer(skills) %in% c(2, 3) & a18 %in% c(2, 3, 4, -999) ~ 13  # 13. Informal workers
),
wrightclass2_informal = factor(
wrightclass2_informal,
levels = 1:13,
labels = c(
"1. Capitalists",
"2. Small employers",
"3. Petty bourgeoisie",
"4. Informal self-employed",
"5. Expert managers",
"6. Expert supervisors",
"7. Experts",
"8. Skilled managers",
"9. Skilled supervisors",
"10. Nonskilled managers",
"11. Nonskilled supervisors",
"12. Formal workers",
"13. Informal workers"
)
)
) %>%
set_variable_labels(wrightclass2_informal = "Wright Class Typology + Informal (4)")
frq(data$wrightclass2_informal)
# base survey
data_svy <- as_survey_design(data, weights = rake_wb2)
# Tabla de frecuencias ponderadas
wright_freq_4 <- data_svy %>%
group_by(wrightclass2_informal) %>%
summarise(
freq = survey_mean(vartype = NULL, na.rm = TRUE),
n_unweighted = unweighted(n())
) %>%
mutate(
freq_pct = freq * 100
)
wright_freq_4 %>%
print(n = Inf)
data <- data %>%
mutate(
wrightclass1_reduced = case_when(
as.integer(organization_assets) == 3 & as.integer(skills) %in% c(2, 3) & a18 == 1 ~ 1,                  # 1. Formal workers
as.integer(organization_assets) == 3 & as.integer(skills) %in% c(2, 3) & a18 %in% c(2, 3, 4, -999) ~ 2,  # 2. Informal workers
as.integer(owners) == 1 & a06 %in% c(3, -888, -999) ~ 3,                                                 # 3. Informal self-employed
as.integer(organization_assets) == 1 & as.integer(skills) %in% c(1, 2, 3) ~ 4,                           # 4. Managers
as.integer(organization_assets) == 2 & as.integer(skills) %in% c(1, 2, 3) ~ 5,                           # 5. Supervisors
as.integer(organization_assets) == 3 & as.integer(skills) == 1 ~ 6,                                      # 6. Experts
as.integer(owners) == 1 & a06 %in% c(1, 2) ~ 7,                                                          # 7. Petty bourgeoisie
as.integer(owners) == 2 ~ 8,                                                                             # 8. Small employers
as.integer(owners) == 3 ~ 9                                                                              # 9. Employers
),
wrightclass1_reduced = factor(
wrightclass1_reduced,
levels = 1:9,
labels = c(
"1. Formal workers",
"2. Informal workers",
"3. Informal self-employed",
"4. Managers",
"5. Supervisors",
"6. Experts",
"7. Petty bourgeoisie",
"8. Small employers",
"9. Employers"
)
)
) %>%
set_variable_labels(wrightclass1_reduced = "Wright Class Typology  Reduced (5)")
frq(data$wrightclass1_reduced)
# base survey
data_svy <- as_survey_design(data, weights = rake_wb2)
# Tabla de frecuencias ponderadas
wright_freq_5 <- data_svy %>%
group_by(wrightclass1_reduced) %>%
summarise(
freq = survey_mean(vartype = NULL, na.rm = TRUE),
n_unweighted = unweighted(n())
) %>%
mutate(
freq_pct = freq * 100
)
wright_freq_5 %>%
print(n = Inf)
data <- data %>%
mutate(
wrightclass2_reduced = case_when(
as.integer(organization_assets) == 3 & as.integer(skills) %in% c(2, 3) & a18 == 1 ~ 1,                  # 1. Formal workers
as.integer(organization_assets) == 3 & as.integer(skills) %in% c(2, 3) & a18 %in% c(2, 3, 4, -999) ~ 2, # 2. Informal workers
as.integer(owners2) == 1 & a06 %in% c(3, -888, -999) ~ 3,                                               # 3. Informal self-employed
as.integer(organization_assets) == 1 & as.integer(skills) %in% c(1, 2, 3) ~ 4,                          # 4. Managers
as.integer(organization_assets) == 2 & as.integer(skills) %in% c(1, 2, 3) ~ 5,                          # 5. Supervisors
as.integer(organization_assets) == 3 & as.integer(skills) == 1 ~ 6,                                     # 6. Experts
as.integer(owners2) == 1 & a06 %in% c(1, 2) ~ 7,                                                        # 7. Petty bourgeoisie
as.integer(owners2) == 2 ~ 8,                                                                           # 8. Small employers
as.integer(owners2) == 3 ~ 9                                                                            # 9. Capitalists
),
wrightclass2_reduced = factor(
wrightclass2_reduced,
levels = 1:9,
labels = c(
"1. Formal workers",
"2. Informal workers",
"3. Informal self-employed",
"4. Managers",
"5. Supervisors",
"6. Experts",
"7. Petty bourgeoisie",
"8. Small employers",
"9. Capitalists"
)
)
) %>%
set_variable_labels(wrightclass2_reduced = "Wright Class Typology Reduced + Informal (6)")
frq(data$wrightclass2_reduced)
# base survey
data_svy <- as_survey_design(data, weights = rake_wb2)
# Tabla de frecuencias ponderadas
wright_freq_6 <- data_svy %>%
group_by(wrightclass2_reduced) %>%
summarise(
freq = survey_mean(vartype = NULL, na.rm = TRUE),
n_unweighted = unweighted(n())
) %>%
mutate(
freq_pct = freq * 100
)
wright_freq_6 %>%
print(n = Inf)
