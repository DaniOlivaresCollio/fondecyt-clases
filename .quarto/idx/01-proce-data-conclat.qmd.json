{"title":"Procesamiento Data Conclat","markdown":{"headingText":"Procesamiento Data Conclat","containsRefs":false,"markdown":"\n## Preparación\n\n```{r,echo=FALSE,warning=FALSE,message=FALSE}\nrm(list=ls())\noptions(scipen = 999)\n\nlibrary(pacman)\np_load(bookdown,\n       car,\n       flextable,\n       forcats,\n       ggalluvial,\n       ggplot2,\n       ggrepel,\n       gridExtra,\n       httr,\n       kableExtra,\n       knitr,\n       labelled,\n       lubridate,\n       officer,\n       psych,\n       purrr,\n       readr,\n       readxl,\n       shadowtext,\n       sjmisc,\n       sjPlot,\n       sjlabelled,\n       statar,\n       stringr,\n       survey,        # diseño survey\n       srvyr,         # diseño survey con tidy\n       tidyverse,\n       tinytex,\n       viridis,\n       httr\n       )\n```\n\n### Cargar datos\n\n```{r datos,message=FALSE,warning=FALSE}\nload(\"input/data/datos-conclat.Rdata\")\ndata_raw <- data\n```\n\n### Selección de Variables\n\n```{r data,message=FALSE,warning=FALSE}\ndata <- data_raw %>% \n  select(id,\n         rake_wb2,\n         # Relación con los medios de producción\n         a07,\n         a25, a25_esp, a25_esp_rec,\n         a26,\n         a27,\n         # Skills\n         a02,a02_rec,a03,a03_rec,\n         ciuo08_clio = ciuo08,\n         e05,\n         # Autoridad / orgnización\n         a15,\n         a16,\n         a17_01,a17_02,a17_03,a17_04,a17_05,a17_06,\n         # formalidad\n         a06,                                        # boleta\n         a10,\n         a18\n         )# %>% \n  #sjlabelled::set_na(.,na=c(-999,-888,-777))\n```\n\n## Procesamiento\n\n### relation_mop\n\n```{r}\n# Situación empleo\ndata <- data %>%\n  mutate(\n    a07 = factor(\n      as.numeric(a07),\n      levels = 1:9,\n      labels = c(\n        \"1. Patrón(a) o empleador(a)\",\n        \"2. Trabajador(a) por cuenta propia\",\n        \"3. Empleado(a) u obrero(a) del sector público (Gobierno Central o Municipal)\",\n        \"4. Empleado(a) u obrero(a) de empresas públicas\",\n        \"5. Empleado(a) u obrero(a) del sector privado\",\n        \"6. Servicio doméstico puertas adentro\",\n        \"7. Servicio doméstico puertas afuera\",\n        \"8. FF.AA. y del Orden\",\n        \"9. Familiar no remunerado\"\n      )\n    )\n  ) %>%\n  set_variable_labels(a07 = \"Employment situation (a07)\")\n\nfrq(data$a07)\n\ndata <- data %>%\n  mutate(\n    relation_mop = case_when(\n      as_numeric(a07) == 1 ~ 1,\n      as_numeric(a07) == 2 ~ 2,\n      as_numeric(a07) >= 3 ~ 3,\n      TRUE ~ NA_real_\n      ),\n    relation_mop = factor(\n      relation_mop,\n      levels = 1:3,\n      labels = c(\n        \"1. Employers\",\n        \"2. Self-Employed\",\n        \"3. Salaried\"\n      )\n    )\n  ) %>%\n  set_variable_labels(relation_mop = \"Relation with Means of Production\")\n\nfrq(data$relation_mop)\n```\n\n### company_size\n\n```{r}\nfrq(data$a26)\n\ndata <- data %>%\n  mutate(\n    company_size = case_when(\n      a26 %in% c(1) ~ 1,\n      a26 %in% c(2, 3) ~ 2,\n      a26 %in% c(4, 5) ~ 3,\n      a26 %in% c(6, 7) ~ 4,\n      a26 %in% c(8, 9) ~ 5,\n      TRUE ~ NA_real_\n    ),\n    company_size = factor(\n      company_size, \n      levels = 1:5, \n      labels = c(\n        \"Solo\",\n        \"2-9\",\n        \"10-49\",\n        \"50-199\",\n        \"200 or more\"),\n      ordered = TRUE\n    )\n  ) %>%\n  set_variable_labels(company_size = \"Company Size\")\n\nfrq(data$company_size)\n```\n\n### workplace_size\n\n```{r}\nfrq(data$a27)\n\ndata <- data %>%\n  mutate(\n    workplace_size = case_when(\n      a27 %in% c(1) ~ 1,\n      a27 %in% c(2, 3) ~ 2,\n      a27 %in% c(4, 5) ~ 3,\n      a27 %in% c(6, 7) ~ 4,\n      a27 %in% c(8, 9) ~ 5,\n      TRUE ~ NA_real_\n    ),\n    workplace_size = factor(\n      workplace_size, \n      levels = 1:5, \n      labels = c(\n        \"Solo\",\n        \"2-9\",\n        \"10-49\",\n        \"50-199\",\n        \"200 or more\"),\n      ordered = TRUE\n    )\n  ) %>%\n  set_variable_labels(workplace_size = \"Workplace Size\")\n\nfrq(data$workplace_size)\n```\n\n### owners\n\n- 1 == employers o self employed sin empleados\n- 2 == employers o self employed con 2-9 empleados\n- 3 == employers o self employed com >= 10 empleados\n\n```{r}\ntable(data$relation_mop,data$company_size)\ntable(data$relation_mop,data$workplace_size)\n\ndata <- data %>%\n  mutate(\n    owners = case_when(\n      as.numeric(relation_mop) %in% 1:2 & (as.numeric(company_size) == 1 | (is.na(company_size) & as.numeric(workplace_size) == 1)) ~ 1,\n      as.numeric(relation_mop) %in% 1:2 & (as.numeric(company_size) == 2 | (is.na(company_size) & as.numeric(workplace_size) == 2)) ~ 2,\n      as.numeric(relation_mop) %in% 1:2 & (as.numeric(company_size) >= 3 | (is.na(company_size) & as.numeric(workplace_size) >= 3)) ~ 3,\n      TRUE ~ NA_real_\n    ),\n    owners = factor(\n      owners,\n      levels = 1:3,\n      labels = c(\n        \"1. Solo Self-Employed\",\n        \"2. Small employers\",\n        \"3. Employers\"\n      )\n    )\n  ) %>%\n  set_variable_labels(owners = \"Owners\")\n\nfrq(data$owners)\n```\n\n### owners2\n\n- 1 == employers o self employed sin empleados\n- 2 == employers o self employed con 2-49 empleados\n- 3 == employers o self employed com >= 50 empleados\n\n```{r}\ndata <- data %>%\n  mutate(\n    owners2 = case_when(\n      as.numeric(relation_mop) %in% 1:2 & (as.numeric(company_size) == 1 | (is.na(company_size) & as.numeric(workplace_size) == 1)) ~ 1,\n      as.numeric(relation_mop) %in% 1:2 & (as.numeric(company_size) %in% 2:3 | (is.na(company_size) & as.numeric(workplace_size) %in% 2:3)) ~ 2,\n      as.numeric(relation_mop) %in% 1:2 & (as.numeric(company_size) >= 4 | (is.na(company_size) & as.numeric(workplace_size) >= 4)) ~ 3,\n      TRUE ~ NA_real_\n    ),\n    owners2 = factor(\n      owners2,\n      levels = 1:3,\n      labels = c(\n        \"1. Solo Self-Employed\",\n        \"2. Small employers\",\n        \"3. Employers\"\n      )\n    )\n  ) %>%\n  set_variable_labels(owners2 = \"Owners 2\")\n\nfrq(data$owners2)\n```\n\n### educ\n\n```{r}\nfrq(data$e05)\n\ndata <- data %>%\n  mutate(\n    educ = ifelse(e05 %in% c(-999, -888), NA, e05)\n  ) %>%\n  set_variable_labels(educ = \"Educational level\")\n\nfrq(data$educ)\n```\n\n### ciuo08_clio_2d\n\n```{r}\n# Preparar variables necesarias\n\n## Crear la glosa concatenada\ndata$glosa_ciuo08 <- paste(data$a02, data$a03, sep = \" \")\n\n## Crear isco a 2 dígitos\ndata <- data %>%\n  mutate(\n    ciuo08_clio_2d = as.numeric(substr(ciuo08_clio, 1, 2))\n  ) %>%\n  set_variable_labels(ciuo08_clio_2d = \"ISCO-08: 2 digits\")\n\nfrq(data$ciuo08_clio_2d)\n```\n\n```{r}\n# Revisar los NA\n\n## Armar tabla filtrando a los NA\ntabla_ciuo08_999 <- data %>%\n  filter(as.numeric(ciuo08_clio_2d) < 1) %>%\n  select(ciuo08_clio,\n         ciuo08_clio_2d,\n         glosa_ciuo08, \n         a03,\n         supervisa = a16, \n         educ = e05, \n         rama = a25, \n         a25_esp, \n         rama_esp = a25_esp_rec)\n\n## Pasar tabla a word\ntabla_ft <- flextable(tabla_ciuo08_999)\nread_docx() %>%\n  body_add_flextable(value = tabla_ft) %>%\n  print(target = \"output/tabla_ciuo08_999.docx\")\n\n## Revisar NA con API del INE\n## Enviar la consulta al servidor\nrequest <-  httr::POST(\"https://rapps.ine.cl:9292/predict\", \n                       encode = \"json\",\n                       body =  list(text = tabla_ciuo08_999$glosa_ciuo08,\n                                    classification = \"ciuo\",\n                                    digits = 2))\n\n## Extraer el contenido\nciuo08_ine_999 <- httr::content(request)\n\n## Agregar como nueva columna a la base original\ntabla_ciuo08_999$ciuo08_ine_999 <- unlist(ciuo08_ine_999$cod_final)\n\n## Armar tabla filtrando a los NA con ciuo08 ine 999\ntabla_ciuo08_999_ine <- tabla_ciuo08_999 %>%\n  select(ciuo08_clio,\n         ciuo08_clio_2d,\n         ciuo08_ine_999,\n         glosa_ciuo08, \n         a03,\n         supervisa, \n         educ, \n         rama, \n         rama_esp)\n\n## Pasar tabla a word\ntabla_ft <- flextable(tabla_ciuo08_999_ine)\nread_docx() %>%\n  body_add_flextable(value = tabla_ft) %>%\n  print(target = \"output/tabla_ciuo08_999_ine.docx\")\n```\n\n```{r}\n# Recuperar algunos NA\n\n## Recodificar ciuo08 de NA recuperados\ndata <- data %>%\n  mutate(\n    ciuo08_clio = case_when(\n      ciuo08_clio == \"-999\" & a03 == \"tejer\" ~ \"7318\", # Artesanos de los tejidos, el cuero y materiales similares\n      ciuo08_clio == \"-999\" & a03 == \"mantención\" ~ \"3121\",\n      ciuo08_clio == \"-999\" & a03 == \"aseo limpieza\" ~ \"9111\",\n      ciuo08_clio == \"-999\" & a03 == \"casa\" ~ \"9111\",\n      ciuo08_clio == \"-999\" & a03 == \"supervisar trabajos\" ~ \"3121\",\n      ciuo08_clio == \"-999\" & a03 == \"maquina pesada\" ~ \"8332\",\n      ciuo08_clio == \"-999\" & a03 == \"no responde\" ~ \"9111\",\n      ciuo08_clio == \"-999\" & a03 == \"Independiente\" ~ \"5212\",\n      ciuo08_clio == \"-999\" & a03 == \"estaba en la casa por permiso administrativo\" ~ \"9331\",\n      ciuo08_clio == \"-999\" & a03 == \"no trabja por ahoravendedor\" ~ \"5211\",\n      ciuo08_clio == \"-999\" & a03 == \"organizar y ordenar ropa\" ~ \"5242\",\n      ciuo08_clio == \"-999\" & a03 == \"ordenar y organizar ropa\" ~ \"5242\",\n      ciuo08_clio == \"-999\" & a03 == \"stripper\" ~ \"5249\",\n      TRUE ~ ciuo08_clio\n    )\n  )\n\n## Volver a crear ciuo08 con 2 dígitos y pasar -999 a NA\ndata <- data %>%\n  mutate(\n    ciuo08_clio_2d = as.numeric(substr(ciuo08_clio, 1, 2)),\n    ciuo08_clio_2d = ifelse(ciuo08_clio_2d==-9, NA,ciuo08_clio_2d)\n  ) %>%\n  set_variable_labels(ciuo08_clio_2d = \"ISCO-08: 2 digits\")\n\nfrq(data$ciuo08_clio_2d)\n```\n\n```{r}\n# Chequeo códigos no existentes ciuo clio = 36, 55\n\n## Armar tabla\ntabla_ciuo08_36_55 <- data %>%\n  filter(as.numeric(ciuo08_clio_2d) %in% c(36, 55)) %>%\n  select(ciuo08_clio,\n         ciuo08_clio_2d,\n         glosa_ciuo08,\n         id,\n         supervisa = a16, \n         educ = e05, \n         rama = a25, \n         rama_esp = a25_esp_rec)\n\n## Pasar tabla a word\ntabla_ft <- flextable(tabla_ciuo08_36_55)\nread_docx() %>%\n  body_add_flextable(value = tabla_ft) %>%\n  print(target = \"output/tabla_ciuo08_36_55.docx\")\n\n## Revisar 36 y 55 con API del INE\n## Enviar la consulta al servidor\nrequest <-  httr::POST(\"https://rapps.ine.cl:9292/predict\", \n                       encode = \"json\",\n                       body =  list(text = tabla_ciuo08_36_55$glosa_ciuo08,\n                                    classification = \"ciuo\",\n                                    digits = 2))\n\n## Extraer el contenido\nciuo08_ine_36_55 <- httr::content(request)\n\n## Agregar como nueva columna a la base original\ntabla_ciuo08_36_55$ciuo08_ine_36_55 <- unlist(ciuo08_ine_36_55$cod_final)\n\n## Armar tabla filtrando a los NA con ciuo08 ine 999\ntabla_ciuo08_36_55_ine <- tabla_ciuo08_36_55 %>%\n  select(ciuo08_clio,\n         ciuo08_clio_2d,\n         ciuo08_ine_36_55,\n         glosa_ciuo08, \n         id,\n         supervisa, \n         educ, \n         rama, \n         rama_esp)\n\n## Pasar tabla a word\ntabla_ft <- flextable(tabla_ciuo08_36_55_ine)\nread_docx() %>%\n  body_add_flextable(value = tabla_ft) %>%\n  print(target = \"output/tabla_ciuo08_36_55_ine.docx\")\n```\n\n```{r}\n# Recuperar algunos códigos no existentes\n\n## Recodificar ciuo08 de 36 55 recuperados\ndata <- data %>%\n  mutate(\n    ciuo08_clio = case_when(\n      ciuo08_clio == \"5522\" & id == \"var_223\" ~ \"3343\",\n      ciuo08_clio == \"5521\" & id == \"var_2536\" ~ \"7322\",\n      TRUE ~ ciuo08_clio\n    )\n  )\n\n## Volver a crear ciuo08 con 2 dígitos\ndata <- data %>%\n  mutate(\n    ciuo08_clio_2d = as.numeric(substr(ciuo08_clio, 1, 2)),\n    ciuo08_clio_2d = ifelse(ciuo08_clio_2d==-9, NA,ciuo08_clio_2d)\n  ) %>%\n  set_variable_labels(ciuo08_clio_2d = \"ISCO-08: 2 digits\")\n\nfrq(data$ciuo08_clio_2d)\n```\n\n```{r}\n# Chequeo COMPLETO de códigos ciuo08 con api INE\n\n## Enviar la consulta al servidor\nrequest <-  httr::POST(\"https://rapps.ine.cl:9292/predict\", \n                       encode = \"json\",\n                       body =  list(text = data$glosa_ciuo08,\n                                    classification = \"ciuo\",\n                                    digits = 2))\n\n## Extraer el contenido\nciuo08_ine <- httr::content(request)\n\n## Agregar como nueva columna a la base original\ndata$ciuo08_ine <- unlist(ciuo08_ine$cod_final)\n\n## Volver NA en ciuo08_ine los NA de ciuo08_clio_2d\ndata <- data %>%\n  mutate(\n    ciuo08_ine = ifelse(is.na(ciuo08_clio_2d), NA, ciuo08_ine)\n  )\n\n## Buscar los códigos diferentes\ndiferente_ciuo <- data %>%\n  filter(ciuo08_ine != ciuo08_clio_2d | (is.na(ciuo08_ine) != is.na(ciuo08_clio_2d))) %>%\n  select(glosa_ciuo08, ciuo08_clio_2d, ciuo08_ine)\n\ndiferente_ciuo\n```\n\n### skills\n\n- Experts -> ciuo08_2d == 11 a 34 con universitaria completa o más (educ >= 9) ---> experts\n- Skilled -> ciuo08_2d == 11 a 34 con universitaria incompleta o menos (educ < 9), y\n- Skilled -> ciuo08_2d == 35,36,41:44,53, y \n- Skilled -> ciuo08_2d == 51,54,61,62,71:75,81 con media completa o más (educ >= 5).\n- Unskilled -> ciuo08_2d == 51,54,61,62,71:75,81 con media incompleta o menos, y \n- Unskilled -> ciuo08_2d == 52,63,82,83,90+\n\n- 61 62 71:75 --> skilled\n- 51,54,81 --> unskilled\n\n\n\n```{r}\ndata <- data %>% \n  mutate(\n    skills = case_when(\n      ciuo08_ine <= 34 & educ >= 9 ~ 1,\n      ciuo08_ine <= 34 & is.na(educ)~ 1,  \n      \n      ciuo08_ine <= 34 & educ < 9 ~ 2,\n      ciuo08_ine %in% c(35, 36, 41:44, 53) ~ 2,\n      ciuo08_ine %in% c(51, 54, 61, 62, 71:75, 81) & educ >= 5 ~ 2,\n      ciuo08_ine %in% c(61, 62, 71:75) & is.na(educ) ~ 2,\n      \n      ciuo08_ine %in% c(51, 54, 61, 62, 71:75, 81) & educ <= 4 ~ 3,\n      ciuo08_ine %in% c(52, 63, 82, 83, 91:99) ~ 3,\n      ciuo08_ine %in% c(51, 54, 81) & is.na(educ) ~ 3     \n    ),\n    skills = factor(\n      skills, \n      levels = 1:3,\n      labels = c(\n        \"1. Experts\",\n        \"2. Skilled\",\n        \"3. Unskilled\"\n      )\n    )\n  ) %>%\n  set_variable_labels(skills = \"Skills\")\n\n\nfrq(data$skills)\n```\n\n### formal_position_auth\n\n```{r}\nfrq(data$a15)\n\ndata <- data %>%\n  mutate(\n    formal_position_auth = case_when(\n      as.numeric(relation_mop) %in% c(1, 2) ~ NA_real_,\n      TRUE ~ as.numeric(a15)\n    ),\n    formal_position_auth = factor(\n      formal_position_auth,\n      levels = 1:4,\n      labels = c(\n        \"1. Senior manager or executive\",\n        \"2. Middle manager (e.g., sector, office or branch head)\",\n        \"3. Supervisor or foreperson\",\n        \"4. Regular employee or worker (no supervisory role)\"\n      )\n    )\n  ) %>%\n  set_variable_labels(formal_position_auth = \"Formal position of authority (a15)\")\n\nfrq(data$formal_position_auth)\n```\n\n### supervision\n\n```{r}\nfrq(data$a16)\n\ndata <- data %>%\n  mutate(\n    supervision = case_when(\n      a16 == 1 ~ 1,\n      a16 %in% c(2, -888, -999) ~ 0,\n      TRUE ~ NA_real_\n    )\n  ) %>%\n  set_variable_labels(supervision = \"Supervises other workers (a16)\")\n\nfrq(data$supervision)\n```\n\n### decisionmaking_typology\n\n```{r}\nfrq(data$a17_01)\nfrq(data$a17_02)\nfrq(data$a17_03)\nfrq(data$a17_04)\nfrq(data$a17_05)\nfrq(data$a17_06)\n\ndata <- data %>%\n  mutate(\n    decisionmaking_typology = if_else(\n      is.na(a17_01),\n      NA_real_,\n      rowSums(across(a17_01:a17_06, ~ case_when(\n        .x == 1 ~ 3,\n        .x == 2 ~ 2,\n        .x == 3 ~ 1,\n        .x %in% c(-888, -999) ~ 1,  \n        TRUE ~ NA_real_\n      )), na.rm = TRUE)\n    ),\n    decisionmaking_typology_mean = if_else(\n      is.na(a17_01),\n      NA_real_,\n      rowMeans(across(a17_01:a17_06, ~ case_when(\n        .x == 1 ~ 3,\n        .x == 2 ~ 2,\n        .x == 3 ~ 1,\n        .x %in% c(-888, -999) ~ 1,\n        TRUE ~ NA_real_\n      )), na.rm = TRUE)\n    )\n  ) %>%\n  set_variable_labels(\n    decisionmaking_typology = \"Decision-making typology (sum, inverted)\",\n    decisionmaking_typology_mean = \"Decision-making typology (mean, inverted)\"\n  )\n\nfrq(data$decisionmaking_typology)\nfrq(data$decisionmaking_typology_mean)\n\n# Crear variable con 3 categorías\ndata <- data %>%\n  mutate(\n    decisionmaking_typology_cat = case_when(\n      decisionmaking_typology_mean == 1 ~ 1,\n      decisionmaking_typology_mean > 1 & decisionmaking_typology_mean < 3 ~ 2,\n      decisionmaking_typology_mean == 3 ~ 3\n    ),\n    decisionmaking_typology_cat = factor(\n      decisionmaking_typology_cat,\n      levels = 1:3\n    )\n  ) %>%\n  set_variable_labels(\n    decisionmaking_typology_cat = \"Decision-making typology (recoded 3 categories)\"\n  )\n\nfrq(data$decisionmaking_typology_cat)\n```\n\n### managerial_location_typology\n\n```{r}\ndata <- data %>%\n  mutate(\n    managerial_location_typology = case_when(\n      as.integer(decisionmaking_typology_cat) == 3 & supervision == 1 & as.integer(formal_position_auth) %in% 1:3 ~ 1,\n      as.integer(decisionmaking_typology_cat) == 3 & supervision == 1 & as.integer(formal_position_auth) == 4 ~ 2,\n      as.integer(decisionmaking_typology_cat) == 3 & supervision == 0 & as.integer(formal_position_auth) %in% 1:3 ~ 3,\n      as.integer(decisionmaking_typology_cat) == 3 & supervision == 0 & as.integer(formal_position_auth) == 4 ~ 4,\n      as.integer(decisionmaking_typology_cat) == 2 & supervision == 1 & as.integer(formal_position_auth) %in% 1:3 ~ 5,\n      as.integer(decisionmaking_typology_cat) == 2 & supervision == 1 & as.integer(formal_position_auth) == 4 ~ 6,\n      as.integer(decisionmaking_typology_cat) == 2 & supervision == 0 & as.integer(formal_position_auth) %in% 1:3 ~ 7,\n      as.integer(decisionmaking_typology_cat) == 2 & supervision == 0 & as.integer(formal_position_auth) == 4 ~ 8,\n      as.integer(decisionmaking_typology_cat) == 1 & supervision == 1 & as.integer(formal_position_auth) %in% 1:3 ~ 9,\n      as.integer(decisionmaking_typology_cat) == 1 & supervision == 1 & as.integer(formal_position_auth) == 4 ~ 10,\n      as.integer(decisionmaking_typology_cat) == 1 & supervision == 0 & as.integer(formal_position_auth) %in% 1:3 ~ 11,\n      as.integer(decisionmaking_typology_cat) == 1 & supervision == 0 & as.integer(formal_position_auth) == 4 ~ 12\n    ),\n    managerial_location_typology = factor(\n      managerial_location_typology,\n      levels = 1:12,\n      labels = c(\n        \"1. Manager on all criteria\",\n        \"2. Manager not in formal hierarchy\",\n        \"3. Non-supervisory manager\",\n        \"4. Non-supervisory decision-maker not in formal hierarchy\",\n        \"5. Advisor-manager on all criteria\",\n        \"6. Advisor not in hierarchy\",\n        \"7. Non-supervisory advisor\",\n        \"8. Non-supervisory advisor not in formal hierarchy\",\n        \"9. Sanctioning / task supervisor in hierarchy\",\n        \"10. Sanctioning / task supervisor not in hierarchy\",\n        \"11. Not subordinates but in hierarchy\",\n        \"12. Non-supervisor / non manager on all criteria\"\n      )\n    ),\n    organization_assets = case_when(\n      as.integer(managerial_location_typology) %in% c(1, 2, 3, 5) ~ 1,\n      as.integer(managerial_location_typology) %in% c(6, 7, 9, 10) ~ 2,\n      as.integer(managerial_location_typology) %in% c(4, 8, 11, 12) ~ 3\n    ),\n    organization_assets = factor(\n      organization_assets,\n      levels = 1:3,\n      labels = c(\n        \"1. Manager\",\n        \"2. Supervisor\",\n        \"3. Non-managerial worker\"\n      )\n    )\n  ) %>%\n  set_variable_labels(\n    managerial_location_typology = \"Managerial Location Typology\",\n    organization_assets = \"Organizational Assets\"\n  )\n\nfrq(data$managerial_location_typology)\nfrq(data$organization_assets)\n```\n\n### boletas\n\n```{r}\nfrq(data$a06)\ntable(data$a06, data$relation_mop)\ntable(data$a06, data$owners)\ntable(data$a06, data$owners2)\n```\n\n### inicio_actividades\n\n```{r}\nfrq(data$a10)\ntable(data$a10, data$relation_mop)\ntable(data$a10, data$owners)\ntable(data$a10, data$owners2)\n```\n\n### contrato_escrito \n\n```{r}\nfrq(data$a18)\ntable(data$a18, data$relation_mop)\ntabla <- data %>% \n  filter(as.numeric(owners)==1)\n\ntable(tabla$a18, tabla$a06)\ntable(data$a18, data$a06)\n```\n\n```{r}\ntable(data$owners, data$educ)\n```\n\n## Clases\n\n![](img/wright_classes.jpeg){}\n\n### wright_class\n\n**employers: employers con 10 o más trabajadores**\n\n```{r}\ndata <- data %>%\n  mutate(\n    wright_class = case_when(\n      as.integer(owners) == 3 ~ 1,  # Employers\n      as.integer(owners) == 2 ~ 2,  # Small employers\n      as.integer(owners) == 1 ~ 3,  # Petty bourgeoisie\n      \n      as.integer(organization_assets) == 1 & as.integer(skills) == 1 ~ 4,  # Expert managers\n      as.integer(organization_assets) == 2 & as.integer(skills) == 1 ~ 5,  # Expert supervisors\n      as.integer(organization_assets) == 3 & as.integer(skills) == 1 ~ 6,  # Experts\n      \n      as.integer(organization_assets) == 1 & as.integer(skills) == 2 ~ 7,  # Skilled managers\n      as.integer(organization_assets) == 2 & as.integer(skills) == 2 ~ 8,  # Skilled supervisors\n      as.integer(organization_assets) == 3 & as.integer(skills) == 2 ~ 9,  # Skilled workers\n      \n      as.integer(organization_assets) == 1 & as.integer(skills) == 3 ~ 10, # Nonskilled managers\n      as.integer(organization_assets) == 2 & as.integer(skills) == 3 ~ 11, # Nonskilled supervisors\n      as.integer(organization_assets) == 3 & as.integer(skills) == 3 ~ 12  # Nonskilled workers\n    ),\n    wright_class = factor(\n      wright_class,\n      levels = 1:12,\n      labels = c(\n        \"1. Employers\",\n        \"2. Small employers\",\n        \"3. Petty bourgeoisie\",\n        \"4. Expert managers\",\n        \"5. Expert supervisors\",\n        \"6. Experts\",\n        \"7. Skilled managers\",\n        \"8. Skilled supervisors\",\n        \"9. Skilled workers\",\n        \"10. Nonskilled managers\",\n        \"11. Nonskilled supervisors\",\n        \"12. Nonskilled workers\"\n      )\n    )\n  ) %>%\n  set_variable_labels(wright_class = \"Wright Class Typology\")\n\nfrq(data$wright_class)\n\n# base survey\ndata_svy <- as_survey_design(data, weights = rake_wb2)\ndata_svy <- data_svy %>%\n  mutate(wright_class = fct_drop(wright_class))  # elimina <NA> como nivel\n\n# Tabla de frecuencias ponderadas\nwright_freq <- data_svy %>%\n  group_by(wright_class) %>%\n  summarise(\n    freq = survey_mean(vartype = NULL, na.rm = TRUE),\n    n_unweighted = unweighted(n())\n  ) %>%\n  mutate(\n    freq_pct = freq * 100\n  )\n\nwright_freq %>%\n  print(n = Inf)\n```\n\n### wright_class_2\n\n**capitalists: employers 50 o más trabajadores**\n\n```{r}\ndata <- data %>%\n  mutate(\n    wright_class_2 = case_when(\n      as.integer(owners2) == 3 ~ 1,  # Capitalists\n      as.integer(owners2) == 2 ~ 2,  # Small employers\n      as.integer(owners2) == 1 ~ 3,  # Petty bourgeoisie\n      \n      as.integer(organization_assets) == 1 & as.integer(skills) == 1 ~ 4,  # Expert managers\n      as.integer(organization_assets) == 2 & as.integer(skills) == 1 ~ 5,  # Expert supervisors\n      as.integer(organization_assets) == 3 & as.integer(skills) == 1 ~ 6,  # Experts\n      \n      as.integer(organization_assets) == 1 & as.integer(skills) == 2 ~ 7,  # Skilled managers\n      as.integer(organization_assets) == 2 & as.integer(skills) == 2 ~ 8,  # Skilled supervisors\n      as.integer(organization_assets) == 3 & as.integer(skills) == 2 ~ 9,  # Skilled workers\n      \n      as.integer(organization_assets) == 1 & as.integer(skills) == 3 ~ 10, # Nonskilled managers\n      as.integer(organization_assets) == 2 & as.integer(skills) == 3 ~ 11, # Nonskilled supervisors\n      as.integer(organization_assets) == 3 & as.integer(skills) == 3 ~ 12  # Nonskilled workers\n    ),\n    wright_class_2 = factor(\n      wright_class_2,\n      levels = 1:12,\n      labels = c(\n        \"1. Capitalists\",\n        \"2. Small employers\",\n        \"3. Petty bourgeoisie\",\n        \"4. Expert managers\",\n        \"5. Expert supervisors\",\n        \"6. Experts\",\n        \"7. Skilled managers\",\n        \"8. Skilled supervisors\",\n        \"9. Skilled workers\",\n        \"10. Nonskilled managers\",\n        \"11. Nonskilled supervisors\",\n        \"12. Nonskilled workers\"\n      )\n    )\n  ) %>%\n  set_variable_labels(wright_class_2 = \"Wright Class Typology (2)\")\n\nfrq(data$wright_class_2)\n\n# base survey\ndata_svy <- as_survey_design(data, weights = rake_wb2)\ndata_svy <- data_svy %>%\n  mutate(wright_class_2 = fct_drop(wright_class_2))  # elimina <NA> como nivel\n\n# Tabla de frecuencias ponderadas\nwright_freq_2 <- data_svy %>%\n  group_by(wright_class_2) %>%\n  summarise(\n    freq = survey_mean(vartype = NULL, na.rm = TRUE),\n    n_unweighted = unweighted(n())\n  ) %>%\n  mutate(\n    freq_pct = freq * 100\n  )\n\nwright_freq_2 %>%\n  print(n = Inf)\n```\n\n### wright_class_3\n\n```{r}\ndata <- data %>%\n  mutate(\n    wright_class_3 = case_when(\n      # Employers\n      as.integer(owners) == 3 ~ 1,  \n      \n      # Small employers\n      as.integer(owners) == 2 ~ 2,  \n      \n      # Petty bourgeoisie desagregado según a06\n      as.integer(owners) == 1 & a06 %in% c(1, 2) ~ 3,   # Petty bourgeoisie\n      as.integer(owners) == 1 & a06 %in% c(3, -888, -999) ~ 4,  # Informal self-employed\n      \n      # Expert managers/supervisors/experts\n      as.integer(organization_assets) == 1 & as.integer(skills) == 1 ~ 5,\n      as.integer(organization_assets) == 2 & as.integer(skills) == 1 ~ 6,\n      as.integer(organization_assets) == 3 & as.integer(skills) == 1 ~ 7,\n      \n      # Skilled & nonskilled managers/supervisors\n      as.integer(organization_assets) == 1 & as.integer(skills) %in% c(2, 3) ~ 8,  # Other managers\n      as.integer(organization_assets) == 2 & as.integer(skills) %in% c(2, 3) ~ 9,  # Other supervisors\n      \n      # Workers (skilled + nonskilled) divididos por formalidad a18\n      as.integer(organization_assets) == 3 & as.integer(skills) %in% c(2, 3) & a18 == 1 ~ 10,             # Formal workers\n      as.integer(organization_assets) == 3 & as.integer(skills) %in% c(2, 3) & a18 %in% c(2, 3, 4, -999) ~ 11  # Informal unskilled workers\n    ),\n    \n    wright_class = factor(\n      wright_class,\n      levels = 1:11,\n      labels = c(\n        \"1. Employers\",\n        \"2. Small employers\",\n        \"3. Petty bourgeoisie\",\n        \"4. Informal self-employed\",\n        \"5. Expert managers\",\n        \"6. Expert supervisors\",\n        \"7. Experts\",\n        \"8. Skilled managers\",\n        \"9. Skilled supervisors\",\n        \"10. Formal workers\",\n        \"11. Informal unskilled workers\"\n      )\n    )\n  ) %>%\n  set_variable_labels(wright_class = \"Wright Class Typology (3)\")\n\nfrq(data$wright_class_3)\n\n# base survey\ndata_svy <- as_survey_design(data, weights = rake_wb2)\n# data_svy <- data_svy %>%\n#   mutate(wright_class_3 = fct_drop(wright_class_3))  # elimina <NA> como nivel\n\n# Tabla de frecuencias ponderadas\nwright_freq_3 <- data_svy %>%\n  group_by(wright_class_3) %>%\n  summarise(\n    freq = survey_mean(vartype = NULL, na.rm = TRUE),\n    n_unweighted = unweighted(n())\n  ) %>%\n  mutate(\n    freq_pct = freq * 100\n  )\n\nwright_freq_3 %>%\n  print(n = Inf)\n```\n\n\n\nInformal self employed --> no dan ningun tipo de boleta\nPetty Bourgeoisie --> dan algun tipo de boleta\n\nWorkers\nformales solo los que han firmado contrato de trabajo escrito\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"01-proce-data-conclat.html"},"language":{"toc-title-document":"Tabla de contenidos","toc-title-website":"En esta página","related-formats-title":"Otros formatos","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Fuente","section-title-abstract":"Resumen","section-title-appendices":"Apéndices","section-title-footnotes":"Notas","section-title-references":"Referencias","section-title-reuse":"Reutilización","section-title-copyright":"Derechos de autor","section-title-citation":"Cómo citar","appendix-attribution-cite-as":"Por favor, cita este trabajo como:","appendix-attribution-bibtex":"BibTeX","title-block-author-single":"Autor/a","title-block-author-plural":"Autores/as","title-block-affiliation-single":"Afiliación","title-block-affiliation-plural":"Afiliaciones","title-block-published":"Fecha de publicación","title-block-modified":"Fecha de modificación","callout-tip-title":"Tip","callout-note-title":"Nota","callout-warning-title":"Advertencia","callout-important-title":"Importante","callout-caution-title":"Precaución","code-summary":"Código","code-tools-menu-caption":"Código","code-tools-show-all-code":"Mostrar todo el código","code-tools-hide-all-code":"Ocultar todo el código","code-tools-view-source":"Ver el código fuente","code-tools-source-code":"Ejecutar el código","code-line":"Línea","code-lines":"Líneas","copy-button-tooltip":"Copiar al portapapeles","copy-button-tooltip-success":"Copiado","repo-action-links-edit":"Editar esta página","repo-action-links-source":"Ver el código","repo-action-links-issue":"Informar de un problema","back-to-top":"Volver arriba","search-no-results-text":"Sin resultados","search-matching-documents-text":"documentos encontrados","search-copy-link-title":"Copiar el enlace en la búsqueda","search-hide-matches-text":"Ocultar resultados adicionales","search-more-match-text":"resultado adicional en este documento","search-more-matches-text":"resultados adicionales en este documento","search-clear-button-title":"Borrar","search-detached-cancel-button-title":"Cancelar","search-submit-button-title":"Enviar","search-label":"Buscar","toggle-section":"Alternar sección","toggle-sidebar":"Alternar barra lateral","toggle-dark-mode":"Alternar modo oscuro","toggle-reader-mode":"Alternar modo lector","toggle-navigation":"Navegación de palanca","crossref-fig-title":"Figura","crossref-tbl-title":"Tabla","crossref-lst-title":"Listado","crossref-thm-title":"Teorema","crossref-lem-title":"Lema","crossref-cor-title":"Corolario","crossref-prp-title":"Proposición","crossref-cnj-title":"Conjetura","crossref-def-title":"Definición","crossref-exm-title":"Ejemplo","crossref-exr-title":"Ejercicio","crossref-ch-prefix":"Capítulo","crossref-apx-prefix":"Apéndice","crossref-sec-prefix":"Sección","crossref-eq-prefix":"Ecuación","crossref-lof-title":"Listado de Figuras","crossref-lot-title":"Listado de Tablas","crossref-lol-title":"Listado de Listados","environment-proof-title":"Prueba","environment-remark-title":"Observación","environment-solution-title":"Solución","listing-page-order-by":"Ordenar por","listing-page-order-by-default":"Por defecto","listing-page-order-by-date-asc":"Menos reciente","listing-page-order-by-date-desc":"Más reciente","listing-page-order-by-number-desc":"De mayor a menor","listing-page-order-by-number-asc":"De menor a mayor","listing-page-field-date":"Fecha","listing-page-field-title":"Título","listing-page-field-description":"Descripción","listing-page-field-author":"Autor/a","listing-page-field-filename":"Nombre de archivo","listing-page-field-filemodified":"Fecha de modificación","listing-page-field-subtitle":"Subtítulo","listing-page-field-readingtime":"Tiempo de lectura","listing-page-field-categories":"Categorías","listing-page-minutes-compact":"{0} minutos","listing-page-category-all":"Todas","listing-page-no-matches":"No hay resultados"},"metadata":{"lang":"es","fig-responsive":true,"quarto-version":"1.3.450","bibliography":["references.bib"],"editor":"visual","theme":"cosmo"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"01-proce-data-conclat.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"editor":"visual","documentclass":"scrreprt"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}